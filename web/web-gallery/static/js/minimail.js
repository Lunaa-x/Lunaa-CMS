/* Copyright: InteRiders <http://interiders.com/> - Distributed under MIT - Keep this message! */
var ResizableTextbox=Class.create({options:$H({minWidth:72,maxWidth:500,step:12}),initialize:function(B,A){var C=this;this.options.update(A);this.el=$(B);this.width=this.el.offsetWidth;this.el.observe(Prototype.Browser.IE?"keydown":"keypress",function(){var D=C.options.get("step")*$F(this).length;
if(D<C.options.get("minWidth")){D=C.options.get("minWidth")}if(D>C.options.get("maxWidth")){D=C.options.get("maxWidth")}this.setStyle({width:D+"px"})}).observe("keydown",function(){this.cacheData("rt-value",$F(this).length)})}});var TextboxList=Class.create({options:$H({resizable:{},className:"bit",separator:"###",extrainputs:true,startinput:true,hideempty:true,fetchFile:undefined,results:10,wordMatch:false}),initialize:function(B,A){this.options.update(A);
this.element=$(B).hide();this.bits=new Hash();this.events=new Hash();this.count=0;this.current=false;this.maininput=this.createInput({"class":"maininput"});this.holder=new Element("ul",{"class":"tbl-holder"}).insert(this.maininput);this.element.insert({before:this.holder});this.holder.observe("click",function(C){C.stop();
if(this.maininput!=this.current){this.focus(this.maininput)}}.bind(this));this.makeResizable(this.maininput);this.setEvents()},setEvents:function(){document.observe(Prototype.Browser.IE?"keydown":"keypress",function(A){if(!this.current){return }if(this.current.retrieveData("type")=="box"&&A.keyCode==Event.KEY_BACKSPACE){A.stop()
}}.bind(this));document.observe("keyup",function(A){A.stop();if(!this.current){return }switch(A.keyCode){case Event.KEY_LEFT:return this.move("left");case Event.KEY_RIGHT:return this.move("right");case Event.KEY_DELETE:case Event.KEY_BACKSPACE:return this.moveDispose()}}.bind(this)).observe("click",function(){document.fire("blur")
}.bindAsEventListener(this))},update:function(){this.element.value=this.bits.values().join(this.options.get("separator"));return this},add:function(C,A){var D=this.options.get("className")+"-"+this.count++;var B=this.createBox($pick(A,C),{id:D});(this.current||this.maininput).insert({before:B});B.observe("click",function(E){E.stop();
this.focus(B)}.bind(this));this.bits.set(D,C.id);if(this.options.get("extrainputs")&&(this.options.get("startinput")||B.previous())){this.addSmallInput(B,"before")}return B},addSmallInput:function(C,B){var A=this.createInput({"class":"smallinput"});C.insert({}[B]=A);A.cacheData("small",true);this.makeResizable(A);
if(this.options.get("hideempty")){A.hide()}return A},dispose:function(A){this.bits.unset(A.id);if(A.previous()&&A.previous().retrieveData("small")){A.previous().remove()}if(this.current==A){this.focus(A.next())}A.remove();return this},focus:function(B,A){if(!this.current){B.fire("focus")}else{if(this.current==B){return this
}}this.blur();B.addClassName(this.options.get("className")+"-"+B.retrieveData("type")+"-focus");if(B.retrieveData("small")){B.setStyle({display:"block"})}if(B.retrieveData("type")=="input"){if(!!this.options.get("onInputFocus")){this.options.get("onInputFocus")(this)}if(!A){this.callEvent(B.retrieveData("input"),"focus")
}}else{B.fire("onBoxFocus")}this.current=B;return this},blur:function(B){if(!this.current){return this}if(this.current.retrieveData("type")=="input"){var A=this.current.retrieveData("input");if(!B){this.callEvent(A,"blur")}if(!!this.options.get("onInputBlur")){this.options.get("onInputBlur")(this)}}else{this.current.fire("onBoxBlur")
}if(this.current.retrieveData("small")&&!A.get("value")&&this.options.get("hideempty")){this.current.hide()}this.current.removeClassName(this.options.get("className")+"-"+this.current.retrieveData("type")+"-focus");this.current=false;return this},createBox:function(B,A){return new Element("li",A).addClassName(this.options.get("className")+"-box").update(B).cacheData("type","box")
},createInput:function(B){var A=new Element("li",{"class":this.options.get("className")+"-input"});var D=new Element("input",Object.extend(B,{type:"text"}));D.setAttribute("autocomplete","off");if(!!this.options.get("maxLength")){D.setAttribute("maxlength",this.options.get("maxLength"))}D.observe("click",function(E){E.stop()
}).observe("focus",function(E){if(!this.isSelfEvent("focus")){this.focus(A,true)}}.bind(this)).observe("blur",function(){if(!this.isSelfEvent("blur")){this.blur(true)}}.bind(this)).observe("keydown",function(E){this.cacheData("lastvalue",this.value).cacheData("lastcaret",this.getCaretPosition())});var C=A.cacheData("type","input").cacheData("input",D).insert(D);
return C},callEvent:function(B,A){this.events.set(A,B);B[A]()},isSelfEvent:function(A){return(this.events.get(A))?!!this.events.unset(A):false},makeResizable:function(A){var B=A.retrieveData("input");B.cacheData("resizable",new ResizableTextbox(B,Object.extend(this.options.get("resizable"))));return this
},checkInput:function(){var A=this.current.retrieveData("input");return(!A.retrieveData("lastvalue")||(A.getCaretPosition()===0&&A.retrieveData("lastcaret")===0))},move:function(B){var A=this.current[(B=="left"?"previous":"next")]();if(A&&(!this.current.retrieveData("input")||((this.checkInput()||B=="right")))){this.focus(A)
}return this},moveDispose:function(){if(this.current.retrieveData("type")=="box"){return this.dispose(this.current)}if(this.checkInput()&&this.bits.keys().length&&this.current.previous()){return this.focus(this.current.previous())}},clear:function(){this.bits.keys().each(function(A){this.dispose($(A))
}.bind(this))}});Element.addMethods({getCaretPosition:function(){if(this.createTextRange){var A=document.selection.createRange().duplicate();A.moveEnd("character",this.value.length);if(A.text===""){return this.value.length}return this.value.lastIndexOf(A.text)}else{return this.selectionStart}},cacheData:function(B,A,C){if(Object.isUndefined(this[$(B).identify()])||!Object.isHash(this[$(B).identify()])){this[$(B).identify()]=$H()
}this[$(B).identify()].set(A,C);return B},retrieveData:function(B,A){return this[$(B).identify()].get(A)},filter:function(H,G){var I=[];for(var J=0,F=this.length;J<F;J++){if(H.call(G,this[J],J,this)){I.push(this[J])}}return I}});function $pick(){for(var D=0,C=arguments.length;D<C;D++){if(!Object.isUndefined(arguments[D])){return arguments[D]
}}return null}var LinkTool=Class.create();LinkTool.prototype={initialize:function(A,B){this.elements=Object.extend({button:$("linktool-find"),input:$("linktool-query"),results:$("linktool-results"),scopeButtons:$$(".linktool-scope")},B||{});this.textarea=A;this.elements.results.hide();Event.observe(this.elements.button,"click",this.search.bind(this));
Event.observe(this.elements.input,Prototype.Browser.IE?"keydown":"keypress",function(C){if(C.keyCode==Event.KEY_RETURN){this.search(C)}}.bind(this));Event.observe(this.elements.results,"click",function(D){var C=D.findElement("a");if(C&&C.hasClassName("linktool-result")){D.stop();this.addLink(C.readAttribute("type"),C.readAttribute("value"),C.readAttribute("title"))
}}.bind(this));this.elements.scopeButtons.invoke("observe","click",function(C){if(!!$F(this.elements.input)&&this.elements.results.visible()){this.search()}}.bind(this))},addLink:function(A,B,C){if(!this.textarea.getSelection()||this.textarea.getSelection()==""){this.textarea.replaceSelection("["+A+"="+B+"]"+C+"[/"+A+"]")
}else{this.textarea.wrapSelection("["+A+"="+B+"]","[/"+A+"]")}this.elements.results.hide()},search:function(C){if(!!C){Event.stop(C)}this.elements.results.setStyle({display:"block"});var B=$F(this.elements.input);if(!!B){this.elements.input.removeClassName("error");this.elements.results.wait();var A=1;
this.elements.scopeButtons.each(function(D){if(D.checked){A=D.value}});new Ajax.Updater(this.elements.results,habboReqPath+"habblet/myhabbo_linktool_search.php",{method:"get",parameters:{query:B,scope:A}})}else{this.elements.input.addClassName("error")}}};var AutocompleteList=Class.create(TextboxList,{loptions:$H({autocomplete:{maxresults:10,minchars:1}}),initialize:function($super,C,E,A,D){$super(C,A);
this.data=A.data;this.autoholder=$(E);this.autoholder.observe("mouseover",function(){this.curOn=true}.bind(this)).observe("mouseout",function(){this.curOn=false}.bind(this));this.autoresults=this.autoholder.select("ul").first();var B=this.autoresults.select("li");B.each(function(F){this.add({id:F.readAttribute("value"),name:F.innerHTML})
},this)},autoShow:function(B,E){var C=0;if(!!E||(!!B&&!!B.strip()&&!!B.length&&B.length>=this.loptions.get("autocomplete").minchars)){this.resultsshown=true;this.hideInstructions();this.autoresults.show();this.autoresults.update("");var D=new RegExp(B,"i");var A=this.bits.values();this.data.filter(function(F){return A.indexOf(F.id)==-1
}).filter(function(F){if(E){return F}else{return F?D.test(F.name):false}}).each(function(F,H){C++;if(H>=this.loptions.get("autocomplete").maxresults){return }var I=this;var G=new Element("li");if(F.pic){G.setStyle({backgroundImage:"url("+F.pic+")"})}G.observe("click",function(J){J.stop();I.autoAdd(this)
}).observe("mouseover",function(){I.autoFocus(this)}).update(this.autoHighlight(F.name,B));this.autoresults.insert(G);G.cacheData("result",F);if(H==0){this.autoFocus(G)}},this)}if(C==0){this.autoHide();this.showInstructions()}else{if(C>this.options.get("results")){this.autoresults.setStyle({height:(this.options.get("results")*24)+"px"})
}else{this.autoresults.setStyle({height:(C?(C*24):0)+"px"})}}return this},autoHighlight:function(B,A){if(!!A){return B.gsub(new RegExp(A,"i"),function(C){return"<em>"+C[0]+"</em>"})}else{return B}},autoHide:function(){this.resultsshown=false;this.autoresults.hide();return this},autoFocus:function(A){if(!A){return 
}if(this.autocurrent){this.autocurrent.removeClassName("auto-focus")}this.autocurrent=A.addClassName("auto-focus");return this},autoMove:function(A){if(!this.resultsshown){return }this.autoFocus(this.autocurrent[(A=="up"?"previous":"next")]());this.autoresults.scrollTop=this.autocurrent.positionedOffset()[1]-this.autocurrent.getHeight();
return this},autoAdd:function(C){var A=C.retrieveData("result");if(!C||!A){return }this.add(A);delete this.data[this.data.indexOf(Object.toJSON(A))];this.autoHide();var B=this.lastinput||this.maininput.retrieveData("input");B.clear().focus();this.showInstructions();return this},createInput:function($super,C){var A=$super(C);
var B=A.retrieveData("input");B.setAttribute("tabindex","1");B.observe("keydown",function(D){this.dosearch=false;switch(D.keyCode){case Event.KEY_UP:D.stop();return this.autoMove("up");case Event.KEY_DOWN:if(this.resultsshown||B.value!=""){D.stop();return this.autoMove("down")}case Event.KEY_TAB:if(!this.resultsshown){break
}case Event.KEY_RETURN:D.stop();if(!this.autocurrent){break}if(this.resultsshown){this.autoAdd(this.autocurrent)}this.autocurrent=false;this.autoenter=true;break;case Event.KEY_ESC:this.autoHide();if(this.current&&this.current.retrieveData("input")){this.current.retrieveData("input").clear()}break;default:this.dosearch=true
}}.bind(this));B.observe("keyup",function(D){switch(D.keyCode){case Event.KEY_UP:case Event.KEY_RETURN:case Event.KEY_ESC:break;case Event.KEY_DOWN:if(!this.resultsshown&&B.value==""){this.autoShow(B.value,true)}break;default:if(this.dosearch){this.autoShow(B.value)}}}.bind(this));B.observe(Prototype.Browser.IE?"keydown":"keypress",function(D){this.autoenter=false
}.bind(this));if(Prototype.Browser.Gecko){new Form.Element.Observer(B,0.2,function(D,E){if(this.dosearch){this.autoShow(B.value)}}.bind(this))}return A},createBox:function($super,C,B){var A=$super(C.name,B);A.observe("mouseover",function(){this.addClassName("bit-hover")}).observe("mouseout",function(){this.removeClassName("bit-hover")
});return A},add:function($super,D,B){var C=$super(D,B);if(D.pic){C.setStyle({backgroundImage:"url("+D.pic+")"})}if(this.options.get("maxRecipients")>0&&this.bits.size()>=this.options.get("maxRecipients")){this.maxRecipientsReached=true;this.hideInstructions();var A=this.lastinput||this.maininput.retrieveData("input");
A.hide();if(!!this.options.get("maxRecipientsReachedCallback")){this.options.get("maxRecipientsReachedCallback")()}}return C},dispose:function($super,B){$super(B);if(this.options.get("maxRecipients")==0||this.bits.size()<this.options.get("maxRecipients")){this.maxRecipientsReached=false;this.showInstructions();
var A=this.lastinput||this.maininput.retrieveData("input");A.show()}},showInstructions:function(){if(!this.maxRecipientsReached){this.autoholder.select(".default").first().show()}},hideInstructions:function(){this.autoholder.select(".default").first().hide()}});if(typeof (Object.Event)=="undefined"){Object.Event={eventHandlers:{},observe:function(B,A){if(!this.eventHandlers[B]){this.eventHandlers[B]=$A([])
}this.eventHandlers[B].push(A)},stopObserving:function(B,A){this.eventHandlers[B]=this.eventHandlers[B].without(A)},fireEvent:function(A){if(this.eventHandlers[A]){this.eventHandlers[A].each(function(B){B(this)}.bind(this))}}};Object.Event.createEvent=Object.Event.fireEvent}if(typeof (Control)=="undefined"){Control={}
}Control.TextArea=Class.create();Object.extend(Control.TextArea.prototype,Object.Event);Object.extend(Control.TextArea.prototype,{onChangeTimeoutLength:500,textarea:false,onChangeTimeout:false,initialize:function(A){this.textarea=$(A);$(this.textarea).observe("keyup",this.doOnChange.bindAsEventListener(this));
$(this.textarea).observe("paste",this.doOnChange.bindAsEventListener(this));$(this.textarea).observe("input",this.doOnChange.bindAsEventListener(this))},doOnChange:function(A){if(this.onChangeTimeout){window.clearTimeout(this.onChangeTimeout)}this.onChangeTimeout=window.setTimeout(function(){this.createEvent("change")
}.bind(this),this.onChangeTimeoutLength)},getValue:function(){return this.textarea.value},getSelection:function(){if(typeof (document.selection)!="undefined"){return document.selection.createRange().text}else{if(typeof (this.textarea.setSelectionRange)!="undefined"){return this.textarea.value.substring(this.textarea.selectionStart,this.textarea.selectionEnd)
}else{return false}}},replaceSelection:function(B){if(typeof (document.selection)!="undefined"){this.textarea.focus();var A=document.selection.createRange();A.text=B;A.collapse(false);A.select()}else{if(typeof (this.textarea.setSelectionRange)!="undefined"){selection_start=this.textarea.selectionStart;
this.textarea.value=this.textarea.value.substring(0,selection_start)+B+this.textarea.value.substring(this.textarea.selectionEnd);this.textarea.setSelectionRange(selection_start+B.length,selection_start+B.length)}}this.doOnChange();this.textarea.focus()},wrapSelection:function(A,B){this.replaceSelection(A+this.getSelection()+B)
},insertBeforeSelection:function(A){this.replaceSelection(A+this.getSelection())},insertAfterSelection:function(A){this.replaceSelection(this.getSelection()+A)},injectEachSelectedLine:function(C,A,B){this.replaceSelection((A||"")+$A(this.getSelection().split("\n")).inject([],C).join("\n")+(B||""))},insertBeforeEachSelectedLine:function(C,A,B){this.injectEachSelectedLine(function(E,D){E.push(C+D);
return E},A,B)}});Control.TextArea.ToolBar=Class.create();Object.extend(Control.TextArea.ToolBar.prototype,{textarea:false,toolbar:false,initialize:function(A,B){this.textarea=A;if(B){this.toolbar=$(B)}else{this.toolbar=$(document.createElement("ul"));this.textarea.textarea.parentNode.insertBefore(this.toolbar,this.textarea.textarea)
}},attachButton:function(A,B){A.onclick=function(){return false};$(A).observe("click",B.bindAsEventListener(this.textarea))},addButton:function(A,C,B){c=document.createElement("li");c.className="control-button";link=document.createElement("a");link.href="#";this.attachButton(link,C);c.appendChild(link);
if(B){for(a in B){link[a]=B[a]}}if(A){span=document.createElement("span");span.innerHTML=A;link.appendChild(span)}this.toolbar.appendChild(c)}});Control.TextArea.ToolBar.BBCode=Class.create();Object.extend(Control.TextArea.ToolBar.BBCode.prototype,{textarea:false,toolbar:false,options:{preview:false},initialize:function(A,B){this.textarea=new Control.TextArea(A);
this.toolbar=new Control.TextArea.ToolBar(this.textarea);this.toolbar.toolbar.addClassName("bbcode_toolbar");if(B){for(o in B){this.options[o]=B[o]}}this.toolbar.addButton("Bold",function(){this.wrapSelection("[b]","[/b]")},{id:"bbcode_bold_button"});this.toolbar.addButton("Italics",function(){this.wrapSelection("[i]","[/i]")
},{id:"bbcode_italics_button"});this.toolbar.addButton("Underline",function(){this.wrapSelection("[u]","[/u]")},{id:"bbcode_underline_button"});this.toolbar.addButton("Quote",function(){this.wrapSelection("[quote]","[/quote]")},{id:"bbcode_quote_button"});this.toolbar.addButton("Small size",function(){this.wrapSelection("[size=small]","[/size]")
},{id:"bbcode_smallsize_button"});this.toolbar.addButton("Large size",function(){this.wrapSelection("[size=large]","[/size]")},{id:"bbcode_largesize_button"});this.toolbar.addButton("Code",function(){this.wrapSelection("[code]","[/code]")},{id:"bbcode_code_button"});this.toolbar.addButton("Link",function(){var D=this.getSelection();
var E=D;var F="http://";var C=D.match(/^\s*(\w+:\/*)?([^\(\)\?&"'\s]*)([^:\(\)"'\s]*).*/);if(C!=null){D=C[2]+C[3];E=C[2];if(D.search(/\./)==-1){F="";D=C[2]}D=D.replace(/\[.*?\]/g,"")}this.replaceSelection("[url="+F+D+"]"+E+"[/url]")},{id:"bbcode_link_button"})},addColorSelect:function(G,C,E){var B=document.createElement("select");
if(E){var H=170;if(navigator.appVersion.match(/\bMSIE\b/)){H+=4}B.style.width=(Element.getDimensions(this.textarea.textarea).width-H-3)+"px"}Event.observe(B,"change",function(J){Event.stop(J);if(B.selectedIndex==0){return }var I=Event.element(J).value;B.selectedIndex=0;this.textarea.wrapSelection("[color="+I+"]","[/color]")
}.bind(this));var F=document.createElement("option");F.innerHTML=G;B.appendChild(F);B.selectedIndex=0;for(var D in C){F=document.createElement("option");F.innerHTML=C[D][1];F.style.color=C[D][0];F.value=D;B.appendChild(F)}var A=new Element("li",{className:"control-button"});A.appendChild(B);this.toolbar.toolbar.appendChild(A)
},addHabboLinkTools:function(){var A=new Element("li",{className:"linktools"});var B=new Element("div");B.insert(L10N.get("linktool.find.label")+" ");var D=function(G,J,I){var H={name:"linktool-scope",type:"radio",value:J};if(I){H.checked="checked"}B.appendChild(new Element("input",H));B.insert(G+" ")
};D(L10N.get("linktool.scope.habbos"),1,true);D(L10N.get("linktool.scope.rooms"),2);D(L10N.get("linktool.scope.groups"),3);var C=new Element("input",{name:"linktool-query",type:"text",size:20});B.appendChild(C);A.appendChild(B);A.insert(" ");var F=new Element("a",{href:"#",className:"new-button search-icon"});
F.appendChild(new Element("b")).appendChild(new Element("span"));F.appendChild(new Element("i"));A.appendChild(F);var E=new Element("div",{className:"linktool-results"});A.appendChild(E);new LinkTool(this.textarea,{button:F,input:C,results:E,scopeButtons:A.select('input[name="linktool-scope"]')});this.toolbar.toolbar.appendChild(A)
}});var MiniMail=Class.create();MiniMail.prototype={initialize:function(G){var Y=this;var L={pageSize:3,start:0,total:0,bodyMaxLength:4096,secondLevel:false,label:"inbox",conversationId:null,unreadOnly:false,nextPage:function(){Y.options.start+=Y.options.pageSize;if(Y.options.start>Y.options.total){Y.options.lastPage()
}},prevPage:function(){Y.options.start-=Y.options.pageSize;if(Y.options.start<0){Y.options.start=0}},firstPage:function(){Y.options.start=0},lastPage:function(){Y.options.start=Y.options.total-Y.options.total%Y.options.pageSize-(Y.options.total%Y.options.pageSize==0?Y.options.pageSize:0)},reset:function(){Y.options.start=0;
Y.options.unreadOnly=false}};Y.options=Object.extend(L,G||{});Y.element=$("minimail");if(Y.options.secondLevel){Y.element.addClassName("second-level-auth")}Y.updateTarget=Y.element.down(".minimail-contents");$("message-compose").observe("submit",Event.stop);var R=function(h){return $(h).up(".message-item").id.substring(4)
};var F=function(h){Y.updateTarget.setStyle({visibility:"hidden"});Z(h,"error",20000)};var J=function(h,j){var i=function(k,l){return function(n,m){if(403==n.status){F(n.responseText);return }if(m&&(!!m.errorMessage||!!m.subjectError||!!m.bodyError)){if(!!$("message-subject")){if(!!m.subjectError){$("message-subject").addClassName("error")
}else{$("message-subject").removeClassName("error")}}if(!!$("message-body")){if(!!m.bodyError){$("message-body").addClassName("error")}else{$("message-body").removeClassName("error")}}Z([m.errorMessage||null,m.subjectError||null,m.bodyError||null].compact().join("<br />"),"error");Y.updateTarget.select(".navigation .progress").invoke("update","");
if(typeof l=="function"){l()}return }$("message-compose").hide();Y.updateTarget.update(n.responseText);Y.updateTarget.select(".navigation .progress").invoke("update","");if(m){Y.options.total=m.totalMessages}if(typeof k=="function"){k()}if(m&&m.message){Z(m.message)}if(Y.element.down("div.re-auth")!=null){Y.element.addClassName("second-level-auth")
}Rounder.init()}};j.onComplete=i(j.onComplete,j.onError);Y.updateTarget.select(".navigation .progress").each(Element.wait);new Ajax.Request(h,j)};var f=function(h){Y.options.label=h;Y.options.reset();J(habboReqPath+"habblet/minimail_loadMessage.php",{parameters:{label:Y.options.label}})};var d=function(h){h.apply(this);J(habboReqPath+"habblet/minimail_loadMessage.php",{parameters:{label:Y.options.label,start:Y.options.start,conversationId:Y.options.conversationId,unreadOnly:Y.options.unreadOnly}})
};var T=function(){var l=$("message-subject");var k=$("message-body");var i=function(m,n){if(!m(n)){n.addClassName("error");return false}else{n.removeClassName("error")}return true};var j=i(function(m){return Y.recipientInput.bits.size()>0},Y.recipientInput.holder);var h=i(function(m){return m.value.length>0
},l);return j&&h&&N(k)};var N=function(h){if(h.value.length==0){return confirm(L10N.get("minimail.empty_body.confirm"))}return true};var X=function(h){var j=Y.recipientInput.bits.values().join(",");if(!T()){return }var k=$("message-subject");var i=$("message-body");J(habboReqPath+"habblet/minimail_sendMessage.php",{parameters:{recipientIds:j,subject:k.value,body:i.value},onComplete:Y.options.reset})
};var O=[];var b=function(h,j){var i=$("msg-"+j);$(h).next().toggle();if($(h).next().visible()){var k=i.down("div.message-body").down("div");Element.wait(k);new Ajax.Request(habboReqPath+"habblet/minimail_loadMessage.php",{method:"get",parameters:{messageId:j,label:Y.options.label},onComplete:function(m,l){if(m.status==403){F(m.responseText);
return }k.update(m.responseText)}});i.addClassName("opened");if(i.hasClassName("unread")){$(i).down(".message-preview").morph("background-color: #DCDCDC",{duration:4});$(i).down(".message-body").morph("background-color: #DCDCDC",{duration:4});$(i).down(".message-body-bottom").morph("background-color: #DCDCDC",{duration:4})
}}else{i.removeClassName("opened");i.removeClassName("unread").addClassName("read")}if($("msg-"+j).visible()&&$(h).getAttribute("status")=="unread"&&O.indexOf(j)==-1){O.push(j);$$(".minimail-unread").each(function(l){var m=parseInt(l.down("b").innerHTML);m--;if(m>0){l.down("b").update(m)}else{l.remove()
}})}};var A=function(k,i){var j=$(k).up(2).next("div");var h=j.down("textarea");S(h);Utils.limitTextarea(h,Y.options.bodyMaxLength);$(k).up(2).hide();j.show();$(h).focus();$(k).up(".contents").addClassName("replying")};var S=function(i){if(!i.hasClassName("bbcode-enabled")){var j=new Control.TextArea.ToolBar.BBCode(i);
var h={red:["#d80000",L10N.get("bbcode.colors.red")],orange:["#fe6301",L10N.get("bbcode.colors.orange")],yellow:["#ffce00",L10N.get("bbcode.colors.yellow")],green:["#6cc800",L10N.get("bbcode.colors.green")],cyan:["#00c6c4",L10N.get("bbcode.colors.cyan")],blue:["#0070d7",L10N.get("bbcode.colors.blue")],gray:["#828282",L10N.get("bbcode.colors.gray")],black:["#000000",L10N.get("bbcode.colors.black")]};
j.addColorSelect(L10N.get("bbcode.colors.label"),h,false);j.addHabboLinkTools();i.addClassName("bbcode-enabled")}};var Q=function(h){$(h).up(2).hide();$(h).up(2).previous("div").show();$(h).up(".contents").removeClassName("replying")};var D=function(j,i){var h=$(j).up(2).down("textarea");if(N(h)){J(habboReqPath+"habblet/minimail_sendMessage.php",{parameters:{messageId:i,body:h.value},onComplete:Y.options.reset})
}};var e=function(h,i){var i=i||R(h);$(h).up(3).remove();if(Y.options.total-Y.options.start==1){Y.options.prevPage()}J(habboReqPath+"habblet/minimail_deleteMessage.php",{parameters:{messageId:i,start:Y.options.start,label:Y.options.label,conversationId:Y.options.conversationId}})};var K=function(h,i){var i=i||R(h);$(h).up(3).remove();
if(Y.options.total-Y.options.start==1){Y.options.prevPage()}J(habboReqPath+"habblet/minimail_undeleteMessage.php",{parameters:{messageId:i,start:Y.options.start,label:Y.options.label}})};var H={loading:false,loaded:false};var W=function(h,i){$("message-list").hide();$(h).update(L10N.get("minimail.cancel"));if(Y.options.friendCount==0){$("message-compose").show();
return }if(!!Cookie.get("friendlist")){Cookie.erase("friendlist");H.loaded=false}if(!H.loaded&&!H.loading){var j=$("message-compose-wait");j.wait();j.setStyle({height:$("message-list").getHeight()+"px"});S($("message-compose").down("textarea"));E(function(){j.hide();Utils.limitTextarea("message-body",Y.options.bodyMaxLength);
B(i)})}else{B(i)}};var C=function(h){$("message-compose").hide();$("message-list").show();$(h).update(L10N.get("minimail.compose"));if(!!Y.recipientInput){Y.recipientInput.hideInstructions();Y.recipientInput.clear()}};var B=function(i){if(!!i){i.split(",").each(function(m){var l=Y.recipientInput.bits.values();
var k=Y.recipientInput.data.find(function(n){return n.id==m&&l.indexOf(parseInt(m))<0});if(!!k){Y.recipientInput.add(k)}})}var j=$("message-subject");var h=$("message-body");j.removeClassName("error");j.value="";h.removeClassName("error");h.value="";$("message-compose").select(".preview-area-container").invoke("remove");
$("message-compose").show();if(!i){Y.recipientInput.clear()}};var E=function(h){H.loading=true;new Ajax.Request(habboReqPath+"habblet/minimail_recipients.php",{method:"get",onComplete:function(i){if(i.status==403){F(i.responseText);return }H.loading=false;if(!Y.recipientInput){Y.recipientInput=new AutocompleteList("message-recipients","message-recipients-auto",{data:i.responseText.evalJSON(true),maxLength:32,maxRecipients:Y.options.maxRecipients||10,maxRecipientsReachedCallback:function(){$("message-subject").focus()
},onInputFocus:function(j){j.autoShow()},onInputBlur:function(j){(j.lastinput||j.maininput.retrieveData("input")).clear();j.hideInstructions()}})}else{Y.recipientInput.data=i.responseText.evalJSON(true)}H.loaded=true;if(!!h){h()}}})};var U=function(i,h,j){Y.options.label="conversation";Y.options.conversationId=j;
Y.options.reset();J(habboReqPath+"habblet/minimail_loadMessage.php",{parameters:{label:Y.options.label,messageId:h,conversationId:j}})};var g=function(){Y.updateTarget.select(".navigation .progress").each(Element.wait);J(habboReqPath+"habblet/minimail_emptyTrash",{})};var Z=function(l,k,h){var j="notification "+(k||"");var i=new Element("div",{className:j});
i.update(l);$("minimail").appendChild(i);var m=window.setTimeout(function(){Effect.Fade(i,{afterFinish:function(){try{i.remove()}catch(n){}}})},h||2000);i.observe("click",function(n){window.clearTimeout(m);i.remove()})};var V=function(i,k){Overlay.show();var j=function(){if(!!$("minimail-report")){$("minimail-report").remove()
}Overlay.hide()};var l=function(){j();if(H.loaded){E()}};var h=Dialog.createDialog("minimail-report",L10N.get("minimail.report.title"),false,false,false,j);Dialog.moveDialogToCenter(h);Dialog.setAsWaitDialog(h);h.observe("click",Event.delegate({"a.cancel-report > *":function(m){Event.stop(m);j()},"a.send-report > *":function(m){Event.stop(m);
Dialog.setAsWaitDialog(h);J(habboReqPath+"habblet/minimail_report.php",{parameters:{messageId:k,start:Y.options.start,label:Y.options.label},onComplete:l,onError:l})}}));new Ajax.Request(habboReqPath+"habblet/minimail_confirmReport.php",{parameters:{messageId:k},onComplete:function(m){Dialog.setDialogBody(h,m.responseText)}})};var P=function(j){var k=j.up(2);
var h=k.down("textarea");var l;var i=k.select(".preview-area");if(i.size()>0){l=i.first()}else{l=new Element("div",{className:"preview-area"});k.insert(l)}l.wait();new Ajax.Request(habboReqPath+"habblet/minimail_preview.php",{parameters:{body:h.value},onComplete:function(m){l.update(m.responseText);if(!l.hasClassName("rounded-done")){Rounder.addCorners(l,4,4,"preview-area-container")
}}})};var M=function(h){if(!!window.HabbletLoader){HabbletLoader.openLink(h)}else{window.location.href=h.href}};Event.observe(Y.element,"click",Event.delegate({".labels a":function(h){Event.stop(h);f(Event.element(h).getAttribute("label"))},".labels a *":function(h){Event.stop(h);f(Event.element(h).up("*[label]").getAttribute("label"))
},".compose > *":function(h){Event.stop(h);if($("message-compose").visible()){C(Event.element(h))}else{W(Event.element(h))}},".message-preview":function(h){Event.stop(h);b(Event.element(h),R(Event.element(h)))},".message-preview > *":function(h){Event.stop(h);b(Event.element(h).up(),R(Event.element(h)))
},".navigation .oldest":function(h){Event.stop(h);d(Y.options.lastPage)},".navigation .older":function(h){Event.stop(h);d(Y.options.nextPage)},".navigation .newest":function(h){Event.stop(h);d(Y.options.firstPage)},".navigation .newer":function(h){Event.stop(h);d(Y.options.prevPage)},".related-messages":function(h){Event.stop(h);
U(this,R(Event.element(h)),Event.element(h).id.substring(4))},".send > *":function(h){Event.stop(h);X(Event.element(h))},".reply > *":function(h){Event.stop(h);A(this,R(Event.element(h)))},".delete > *":function(h){Event.stop(h);e(this,R(Event.element(h)))},".undelete > *":function(h){Event.stop(h);K(this,R(Event.element(h)))
},".send-reply > *":function(h){Event.stop(h);D(this,R(Event.element(h)))},".cancel-reply > *":function(h){Event.stop(h);Q(this)},".unread-only":function(h){Y.options.unreadOnly=Event.element(h).checked;J(habboReqPath+"habblet/minimail_loadMessage.php",{parameters:{label:Y.options.label,unreadOnly:Y.options.unreadOnly}})},".empty-trash":function(h){Event.stop(h);
g()},".report":function(h){Event.stop(h);V(Event.element(h),R(Event.element(h)))},".preview > *":function(h){Event.stop(h);P(Event.element(h))},"a.bbcode-home-link":function(h){Event.stop(h);M(Event.element(h))},"a.bbcode-home-link *":function(h){Event.stop(h);M(Event.element(h))},"a.bbcode-group-link":function(h){Event.stop(h);
M(Event.element(h))},"a.bbcode-group-link *":function(h){Event.stop(h);M(Event.element(h))},"a.bbcode-url-link":function(h){Event.stop(h);M(Event.element(h))},"a.bbcode-url-link *":function(h){Event.stop(h);M(Event.element(h))}}));var I=function(i){window.focus();Y.element.scrollTo();var h=i.split("/");
if(h[1]=="compose"){W(Y.element.select(".compose b").first(),h[2])}else{if(h[1]=="inbox"){f("inbox")}}};HashHistory.observe("mail/.*",I);__minimail__sendmsg__=I}};var PrettyDate={};PrettyDate.prettifyDates=function(){var A=function(E){var C=new Date((E||"").replace(/-/g,"/").replace(/[TZ]/g," ")),D=((new Date().getTime()+new Date().getTimezoneOffset()*60000-C.getTime())/1000),B=Math.floor(D/86400);
if(isNaN(B)||B<0||B>=31){return }return B==0&&(D<60&&L10N.get("date.pretty.just_now")||D<120&&L10N.get("date.pretty.one_minute_ago")||D<3600&&L10N.get("date.pretty.minutes_ago",Math.floor(D/60))||D<7200&&L10N.get("date.pretty.one_hour_ago")||D<86400&&L10N.get("date.pretty.hours_ago",Math.floor(D/3600)))||B==1&&L10N.get("date.pretty.yesterday")||B<7&&L10N.get("date.pretty.days_ago",B)||B==7&&L10N.get("date.pretty.one_week_ago")||B<31&&L10N.get("date.pretty.weeks_ago",Math.ceil(B/7))
};$$(".message-tstamp").each(function(B){var C=A(B.getAttribute("isotime"));if(C){B.update(C)}})};HabboView.add(function(){setInterval(PrettyDate.prettifyDates,30000)});__minimail__defined__=true;